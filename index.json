[{"content":"提前准备 机票：香港航空 HX657/658 免费往返机票，但并不免燃油附加费等，共计818元；\n日本签证：淘宝单次签证300元；\n港澳通行证签注：单次15元；\n高铁票：广州 - 香港，单程215元（如果广州 - 深圳北，深圳北 - 香港会更便宜）；\n电话卡：钱多的话可以直接开通漫游，我这里是先在淘宝购买日本电话卡，7天5G，30元，事实证明根本用不了那么多，日本很多景点都有Wifi，但是需要使用邮件注册一下；如果是第一次去日本，可以考虑注册Wamazing，会提供免费的500M流量sim卡，在机场领取即可，搜一些兑换码最高可以获得1.5G流量，在旅行期间不刷视频的话很够用了；\nVJW：日本入境申报电子系统，推荐预先填报，这样就不需要填写纸质入境单了，填写方法可以网上搜索。\nDay1 早早出发去广州南站，出境使用港澳通行证，入香港使用港澳通行证，香港西九龙高铁站走10分钟左右，到达九龙站，乘坐机场快线约20分钟到达香港国际机场。\n机场快线可以使用八达通，也可以用在网上买的电子版，我们用的kkday购买的香港机场快线车票优惠（电子票），82元单人单程，刷二维码即可直接进站，推荐再在大陆或者香港西九龙站内连接港铁Wifi进行购买，否则在香港是没信号的。\n在机场柜台办理登机牌和行李托运业务，香港航空职员还是很专业的根据大陆护照讲了普通话，由于香港人护照免签日本，所以他们会额外检查大陆游客是否持有日本签证，包括在登机前也会再次进行核查。\n注意，香港机场出境也需要刷和入境一致的证件，也就是可以刷港澳通行证自助出境，不要刷成护照。\n随后就是漫长的飞行过程，航线会经过台湾上空，天气好的话可以看到台湾山脉。12月份算是冲绳的旅游淡季，所以入境处人数并不多，给入境管刷VJW，展示电子签就可以了，接下来领行李，过海关，都有足够多的职员指引，非常顺畅。\n我们的第一晚旅店订在Hotel Rocore Naha，距离单轨铁路县厅前站步行5分钟左右的地方，和第二天的旅行团集合地点就隔一个十字路口，据说这家店的自助早餐非常棒，但是由于时间关系，这次没有选择吃他们家的早餐。入住很简单，刷一下护照就可以。\n到冲绳的第一餐选择了在日本的大众点评（Tabelog）上面评分比较高的疾風ホルモン公式ホームページ 烤肉店，一家很有日式居酒屋风格的店铺，去之前在Line上面和店主提前预约了，可以用翻译软件翻译成日语。这个店铺离国际通很近，步行5分钟左右就到了。\r到的时间还早，店里没有其他食客，可以随便拍拍。\n点餐是扫码点餐，比较方便，也有英文中文菜单，点了一个7000日元的套餐，另外还有一杯茶，套餐包含：一小碗牛肉咖喱饭、三个泡菜、三个凉菜、三份不同部位的牛肉、一份牛内脏、一份凉面、一份甜点。约合人民币400一个人，可以说吃的非常饱了。\n自己的烤肉没啥水平，就一个字，好吃。\n这家店是等你吃完一份再上另一份的，所以可以慢慢吃，不着急。最后结账也可以刷银联或者VISA。店员超级热情，还送到电梯口，真的有点尴尬，哈哈。\n如果吃完时间还比较多的话，可以去逛一下国际通，由于第二天还有团，就早早的回旅店休息了。\nDay2 这一天的主要内容是跟团冲绳北方一日游，选择的是KKDay的冲绳中北部一日游 美丽海水族馆4小时停留、古宇利岛、万座毛、美国村｜中文导游旅行团，体感很不错，导游石川姐是早年间嫁入冲绳的中国人，非常负责，讲解当地历史文化和各个景点的内容，最关键的是，不像国内团会拉去买买买，也没有恶心的PUA消费内容，纯玩团。\n万座毛，是本次旅行团的第一站，非常小的一个景点，最出名的就是那个大象鼻子（日版象鼻山）。\n还有远处的钓鱼佬。\n古宇利岛是第二个景点，这里停留时间比较短，没能来得及去海洋塔，不过只在桥上拍海就已经觉得足够震撼了。\n下面是在桥上拍的海景。\n水族馆是本次行程的最后一站，最出名的就是海豚表演、鲸鲨喂食和大水族箱。需要注意时间，这次时间关系就没有去看鲸鲨喂食，选择去园区其他地方逛了一下。\n结束了一天的行程，最终选择住在美国村的DoubleTree by Hilton Okinawa Chatan Resort，很幸运能赶上美丽的夕阳。\n晚上选择乘出租车去Aeon Mall Okinawa Rycom吃饭和采购，大约2000日元的出租车费，这里要免税的话需要买够5000日元才可以，需要带上护照以方便办理手续。\n在永旺第一站要去顾客服务中心领取500日元优惠券，然后谨记晚上9点停止办理退税，而且需要注意的是日本有些店员年龄偏大，处理退税会有些慢，所以采购的话预留时间还是得充足一些的。\nDay3 这一天上午是纯纯的回血，没安排任何活动，睡到自然醒然后去吃自助餐，冲绳拉面的味道还是很不错的，红烧肉炖的软烂，汤底比较浓郁，很适合北方人口味。\n昨天到的太晚，没能好好欣赏一下周围风景，在阳台看出去，外面的景色还是很不错的。\n中午乘车（大巴包车）去市区，车票是在KKDay购买的那霸市内往返美国村 LeaLea OKINAWA 接驳巴士，入住 Hotel JAL CITY Naha酒店。下午体验了美樱 Chura Sakura 浴衣＆和服体验，去了波上宫。\n换装结束，决定去濑长岛碰碰运气，看看能不能赶上另一波夕阳。乘坐单轨到赤岭站，换乘公交TK02，刷VISA卡上车，一站就到，非常方便。\n很幸运，虽然云层很厚，还是抓到了夕阳。\n圣诞将近，来一张岛上的圣诞气息。\n还有一只大肥猫。\n拍完回去吃饭，在全家便利店买了冲绳特色菜，苦瓜炒蛋、荞麦面，还有 Blue Seal 的冰淇淋，味道真的很不错。\nDay4 这一天和昨天一样，只不过是上午躺，下午回家了。这家酒店的早餐很日式，试了一下味增汤，再也不会吃第二次\u0026hellip;\n在机场看到了各样的飞机和军机，在国内想拍到机场的军机基本不可能。\n冲绳机场的香港航空职员似乎是雇佣的机场工作人员，所以他们都是讲英语日语的，安检人手比较少，还是得尽快过去才好，在登机口附近也可以买免税商品，价格和在市区买的一样，推荐虾饼，味道很不错。\n一路飞回香港，入香港使用护照，需要填写入境单，乘坐机场快线到西九龙坐高铁回广州，需要注意，西九龙网上售票提前45分钟截止，所以需要预留足够时间。这里出香港需要刷护照，而进大陆海关则需要刷港澳通行证，一定不要搞错。\n最后，感觉很棒，希望明年香港机场继续搞免费机票活动！\n","permalink":"https://boringleric.github.io/posts/life/okinawa_travel/","summary":"第一次出国，冲绳4日游","title":"冲绳4日游"},{"content":"Deepspeed多机多卡训练记录\n如果用到fp16等半精度训练，需要安装nvidia的apex。\n步骤：\n先让两台机可以ssh通信，在主节点执行ssh-keygen，可以一直回车，生成的密钥在/home/你的用户名/.ssh/下，需要把公钥id_rsa.pub传到子节点的对应.ssh文件夹下，并且重命名为authorized_keys，私钥保留在本地即可。\n一定要注意：主节点上也需要将id_rsa.pub 拷贝成authorized_keys！！！\n随后可以ssh连接子节点测试一下，不需要输入密码也可以连接。\n在系统层面安装pdsh来帮助nccl通信，在我这里使用的debian直接apt安装就可以了。\n我这里主从系统配置了完全一样的系统、conda环境、conda虚拟环境名称，代码路径，代码完全保持一致。\n配置hostfile，格式为：192.168.x.xx slots=2；前面是标注机器，注意主机要放到第一行，slot代表每台机显卡数量。\n可以通过DeepSpeed/DeepSpeedExamples/pipeline_parallelism这个例子进行单机多卡、多机多卡测试，区别是多级多卡测试需要加一行\u0026ndash;hostfile=hostfile。\n遇到的问题：\ncannot import name \u0026lsquo;UnencryptedCookieSessionFactoryConfig\u0026rsquo; from \u0026lsquo;pyramid.session\u0026rsquo; (unknown location)\n问题定位：不要pip install apex，这不是nVidia的apex，需要去github下载。\n解决方法：GitHub - NVIDIA/apex: A PyTorch Extension: Tools for easy mixed precision and distributed training in Pytorch 在这里安装。\nModuleNotFoundError: No module named \u0026lsquo;fused_layer_norm_cuda\u0026rsquo;\n问题定位：apex和cuda/pytorch不匹配，apex代码错误等都有可能出现。\n解决方案：我这里是根据github的apex issue重新下载了符合pytorch版本的apex版本重新编译就好了。\n​\t3. proxy call to rank 1 failed (connect)\n​\t问题定位：NCCL机器通讯问题\n​\t解决方案：\n​\texport NCCL_DEBUG=INFO ​\texport NCCL_IB_DISABLE=1 ​\texport NCCL_SOCKET_IFNAME=网卡名字\nNinja is required to load C++ extensions ​\t问题定位：Ninja找不到path中的C++库位置\n​\t解决方案：\nimport os new_env = os.environ.copy() new_env [\u0026#34;PATH\u0026#34;] = \u0026#34;/本地conda环境/bin:\u0026#34; + new_env [\u0026#34;PATH\u0026#34;] os.environ.update(new_env ) ","permalink":"https://boringleric.github.io/posts/tech/deepspeed_multinode_multicard/","summary":"Deepspeed多机多卡训练记录 如果用到fp16等半精度训练，需要安装nvidia的apex。 步骤： 先让两台机可以ssh通信，在主节点执行ssh-keygen，可以一直回车，生成的密钥在/home/你的用户名/.ssh/下，需要把公钥id_rsa.pub传到子节点的对应.ssh","title":"Deepspeed多机多卡训练记录"},{"content":"A Boring Guy\n","permalink":"https://boringleric.github.io/about/","summary":"A Boring Guy","title":"About"}]